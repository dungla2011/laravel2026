CREATE TABLE `vps_plans` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(64) NOT NULL,
    `status` SMALLINT DEFAULT 1,
    `user_id` BIGINT DEFAULT NULL,

    -- Thêm các trường phù hợp cho plan
    `cpu` INT NOT NULL,
    `ram_gb` INT NOT NULL,
    `disk_gb` INT NOT NULL,
    `network_mbit` INT DEFAULT 0,  -- băng thông dedicated theo Mbps
    `number_ip_address` INT DEFAULT 1,  -- số IP address
    `price_per_minute` DECIMAL(18,8) NOT NULL,
    `price_per_hour` DECIMAL(18,8) GENERATED ALWAYS AS (`price_per_minute` * 60) STORED,

    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `deleted_at` DATETIME DEFAULT NULL,
    `log` TEXT NULL,

    PRIMARY KEY (`id`),
    KEY `idx_deleted_at` (`deleted_at`),
    KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `vps_instances` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(64) NOT NULL,
    `status` SMALLINT DEFAULT 1,
    `user_id` BIGINT DEFAULT NULL,

    `plan_id` BIGINT DEFAULT NULL,
    `cpu` INT NOT NULL,
    `ram_gb` INT NOT NULL,
    `disk_gb` INT NOT NULL,
    `network_mbit` INT DEFAULT 0,  -- băng thông dedicated khách đã mua
    `number_ip_address` INT DEFAULT 1,  -- số IP address khách mua
    `price_per_minute` DECIMAL(18,8) NOT NULL,
    `vmware_vm_id` VARCHAR(128) DEFAULT NULL,
    `power_state` VARCHAR(32) DEFAULT 'powered_off',

    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `deleted_at` DATETIME DEFAULT NULL,
    `log` TEXT NULL,
    `infos` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`infos`)),


    PRIMARY KEY (`id`),
    KEY `idx_deleted_at` (`deleted_at`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_plan_id` (`plan_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `vps_instance_config_history` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(64) DEFAULT NULL,
    `status` SMALLINT DEFAULT 1,
    `user_id` BIGINT DEFAULT NULL,

    `instance_id` BIGINT NOT NULL,
    `cpu` INT NOT NULL,
    `ram_gb` INT NOT NULL,
    `disk_gb` INT NOT NULL,
    `network_mbit` INT DEFAULT 0,  -- lịch sử băng thông dedicated
    `number_ip_address` INT DEFAULT 1,  -- lịch sử số IP address
    `price_per_minute` DECIMAL(18,8) NOT NULL,
    `change_type` VARCHAR(64) DEFAULT NULL,
    `changed_at` DATETIME DEFAULT CURRENT_TIMESTAMP,

    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `deleted_at` DATETIME DEFAULT NULL,
    `log` TEXT NULL,

    PRIMARY KEY (`id`),
    KEY `idx_deleted_at` (`deleted_at`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_instance_id` (`instance_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `vps_usage` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(64) DEFAULT NULL,
    `status` SMALLINT DEFAULT 1,
    `user_id` BIGINT DEFAULT NULL,

    `instance_id` BIGINT NOT NULL,
    `timestamp_minute` DATETIME NOT NULL,
    `number_ip_address` INT DEFAULT 1,  -- số IP address tại thời điểm sử dụng
    `price_per_minute` DECIMAL(18,8) NOT NULL,
    `power_state` VARCHAR(32) DEFAULT 'running',

    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    `deleted_at` DATETIME DEFAULT NULL,
    `log` TEXT NULL,

    PRIMARY KEY (`id`),
    KEY `idx_deleted_at` (`deleted_at`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_instance_id` (`instance_id`),
    KEY `idx_timestamp_minute` (`timestamp_minute`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
