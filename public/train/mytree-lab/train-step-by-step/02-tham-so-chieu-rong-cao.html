<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vẽ Gia Phả</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        svg {
            border: 1px solid #ccc;
            display: block;
            margin: auto;
        }
    </style>
</head>
<body>
<svg id="familyTreeSvg" width="1200" height="800"></svg>
<script>
    const data = [
        { "id": 2576, "name": "Root Node", "parent_id": null, "married_with": null },
        { "id": 2598, "name": "La Thi Hoa", "parent_id": 2576, "married_with": 2597 },
        { "id": 2597, "name": "Le Van Vinh", "parent_id": 2576, "married_with": null },
        { "id": 2586, "name": "Le Van Thang", "parent_id": 2597, "married_with": null },
        { "id": 2587, "name": "Pham Thi Loi", "parent_id": 2597, "married_with": 2586 },
        { "id": 2580, "name": "Pham Thi Loi1", "parent_id": 2597, "married_with": 2586 },
        { "id": 2599, "name": "Le Van Vui", "parent_id": 2597, "married_with": null },
        { "id": 2599, "name": "Pham Thi Loi2", "parent_id": 2597, "married_with": 2586 },
        { "id": 2602, "name": "Tran Thi Tuoi", "parent_id": 2597, "married_with": 2599 },
        { "id": 2849, "name": "Le Thong Nhat", "parent_id": 2597, "married_with": null },
        { "id": 2588, "name": "Le Van Dong", "parent_id": 2586, "married_with": null },
        { "id": 5545, "name": "Le Van Mai", "parent_id": 2586, "married_with": null },
        { "id": 2600, "name": "Le Van The", "parent_id": 2599, "married_with": null },
        { "id": 2601, "name": "Le Thi Gioi", "parent_id": 2599, "married_with": null },
        { "id": 2605, "name": "Le Van Ky", "parent_id": 2599, "married_with": null },
        { "id": 2606, "name": "Le Thi Dieu", "parent_id": 2599, "married_with": null }
    ];

    const rootId = 2576;

    // Tham số cấu hình
    const nodeWidth = 60;
    const nodeHeight = 40;
    const horizontalSpacing = 20;
    const verticalSpacing = 50;

    // Tạo cấu trúc cây từ danh sách
    function buildTree(data, rootId) {
        const idToNode = {};
        data.forEach(node => {
            idToNode[node.id] = { ...node, children: [] };
        });

        data.forEach(node => {
            if (node.parent_id && idToNode[node.parent_id]) {
                idToNode[node.parent_id].children.push(idToNode[node.id]);
            }
        });

        return idToNode[rootId] || null;
    }

    const root = buildTree(data, rootId);

    // Chuyển đổi dữ liệu sang định dạng D3 tree
    const treeData = d3.hierarchy(root, d => d.children);
    const treeLayout = d3.tree().nodeSize([nodeWidth + horizontalSpacing, nodeHeight + verticalSpacing]);
    treeLayout(treeData);

    const svg = d3.select("#familyTreeSvg");

    // Vẽ các đường nối
    svg.selectAll(".link")
        .data(treeData.links())
        .enter()
        .append("line")
        .attr("class", "link")
        .attr("x1", d => d.source.x + 200)
        .attr("y1", d => d.source.y + 50)
        .attr("x2", d => d.target.x + 200)
        .attr("y2", d => d.target.y + 50)
        .attr("stroke", "#ccc");

    // Vẽ các node
    const nodes = svg.selectAll(".node")
        .data(treeData.descendants())
        .enter()
        .append("g")
        .attr("class", "node")
        .attr("transform", d => `translate(${d.x + 200},${d.y + 50})`);

    nodes.append("rect")
        .attr("width", nodeWidth)
        .attr("height", nodeHeight)
        .attr("x", -nodeWidth / 2)
        .attr("y", -nodeHeight / 2)
        .attr("fill", "#fff")
        .attr("stroke", "#000");

    nodes.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "5")
        .text(d => d.data.name);
</script>
</body>
</html>
